<html>
<head>
  <title>Editor</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/0.0.1/prism.min.css" rel="stylesheet" type="text/css" />
</head>
<body>
  <style>
  pre[class*=language-]>code[data-language] {
    max-height: 9999px;
  }
  </style>
  <pre style="height: 90%">
  <code class="language-css editor" contenteditable></code>
  </pre>
  <button>Save</button>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/0.0.1/prism.min.js"></script>
  <script src="https://cdn.socket.io/socket.io-1.3.0.js"></script>
  <script>

  var socket = io();
  socket.on('news', function (data) {
    console.log(data);
    socket.emit('my other event', { my: 'data' });
  });
  socket.on('log', function (data) {
    console.log(data);
  });
  socket.on('styles', function (data) {
    document.querySelector('.editor').innerText = data;
    Prism.highlightAll();
  });
  socket.emit('get styles');

  var button = document.querySelector('button').addEventListener('click', function () {
    document.querySelector('button').disabled = true;
    console.log('data to save', document.querySelector('.editor').innerText);
    socket.emit('put styles', document.querySelector('.editor').innerText);
  });

  document.querySelector('.editor').addEventListener('blur', function () {
    var text = document.querySelector('.editor').innerText;
    document.querySelector('.editor').innerHTML = text;
    Prism.highlightAll();
    console.log('blur');
  });

  function updateSyntaxHighlighter() {
    var text = document.querySelector('.editor').innerText;
    document.querySelector('.editor').innerHTML = text;
    Prism.highlightAll();
    document.querySelector('button').disabled = false;
  }

  document.querySelector('.editor').addEventListener('blur', updateSyntaxHighlighter);
  document.querySelector('.editor').addEventListener('keyup', updateSyntaxHighlighter);
  document.querySelector('.editor').addEventListener('paste', updateSyntaxHighlighter);
  document.querySelector('.editor').addEventListener('input', updateSyntaxHighlighter);

  </script>
</body>
</html>
